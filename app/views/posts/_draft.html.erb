<style>
.post_image {
  background-image: url(<%= @post.thumbnail.url(:large2) %>);
}
blockquote {
  margin: 1em 0;
  font-style: italic;
}
</style>

<div class="div">
  <% @most_recent_review = @post.reviews.last %>
  <% if !@most_recent_review.nil? && !(@most_recent_review.try(:status).eql? "In Progress") %>
    <%= render '/posts/banner_status' %>
  <% elsif @post.pitch.present? %>
    <p class= "banner_stts">In Progress | Review this draft's pitch <%= link_to("here", @post.pitch, target: "_blank", class: "link_white") %></p>
  <% else %>
    <p class="banner_stts">In Progress</p>
  <% end %>
  <div class="post_image">
  </div>
</div>
<div class="flex_wrapper_posts">
  <div class="skinny wrapper_padding" id="post_show_content">
    <div class="flex_wrapper_columns">
      <div class="content_wrapper">
        <header id="post_title_show">
          <h1 class="title_article_show"><%= @post.title %></h1>
          <h3 id="category_title"><%= link_to(@post.category.name, @post.category) %></h3>
          <div class="post_info">
            <% @authors = [@user] + @collabs %>
            <div class="left_side_flex">
              <% @authors.each do |author| %>
                <div class="author">
                  <% @profile = author.profile.exists? ? author.profile.url(:square) : "profile_image" %>
                  <%= image_tag(@profile, :class => "profile_img") %>
                  <p class="author_name" style="margin-right: 10px;">By <%= link_to(author.full_name, author) %></p>
                </div>
              <% end %>
              <span>
                <i class="fa fa-clock-o" style="margin-right: 3px;" aria-hidden="true"></i>
                <span class="date"><%= @date.strftime('%A, %B %d')%></span>
              </span>
            </div>
          </div>
        </header>
        <div id="content">
          <div class="flex_wrapper_content">
            <div class="post_wrapper">
              <div class="post_content">
                <%= markdown @post.content %>
              </div>
              <% if current_user && (current_user.id == @post.user_id || @post.collaboration == current_user.email || current_user.admin? || current_user.editor?) %>
                <div id="admin_links">
                  <%= link_to "Edit Article", edit_post_path(@post) %>
                  <% if current_user && (current_user.id == @post.user_id || current_user.admin) %>
                  <%= link_to "Delete", post_path(@post), method: :delete, data: {confirm: "Are you sure you want to delete this article?"} %>
                  <% end %>
                </div>
              <% end %>
              <div id= "background">
               <%= render :partial => 'users/profile', locals: {user: @user} %>
               <% @collabs.each do |collab| %>
                <%= render :partial => 'users/profile', locals: {user: collab} %>
               <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="share_article_feedback">
        <% if @post.sharing != true %>
          <h3 class="title">Get peer feedback on your article</h3>
          <br>
          <div class="btn_cntnr">
            <%= link_to "Turn on sharing", post_path(@post, sharing: true), class: "newpost--new--profile" %>
          </div>
        <% else %>
          <h3>Peer comments and reviews</h3>
          <div class="comments">
            <ul class="list-group list-group-flush">
              <% if @comments.count.eql? 0 %>
                <i>Social sharing is turned on! Ask other TTM writers to give their feedback on your article by posting the link to this article in the <a href="https://www.facebook.com/groups/615063885673363/" target="_blank" style="color: #65B19D;">Facebook group</a>.</i>
              <% else %>
                <% @comments.each do |comment| %>
                  <li class="list-group-item comment">
                    <% if (comment.user_id.eql? current_user.id) || (@post.user_id.eql? current_user.id) || (current_user.admin) %>
                      <%= link_to comment_path(comment), method: :delete, class: "delete_btn_x" do %>
                        <i class="fa fa-times"></i>
                      <% end %>
                    <% end %>
                    <% @profile_img = comment.user.profile.exists? ? image_tag(comment.user.profile.url(:square), :class => "profile_img_small") : image_tag("profile_image", :class => "profile_img_small") %>
                    <%= link_to(@profile_img, comment.user) %>
                    <div>
                      <h6><%= link_to comment.user.full_name, comment.user %></h6>
                      <span class="date_ago"><%= comment.user.comments.count %> points, <%= time_ago_in_words(comment.created_at) %> ago</span><br>
                      <span><%= comment.text %></span><br>
                    </div>
                  </li>
                <% end %>
              <% end %>
              <%= form_for @comment do |f| %>
                <%= f.text_field :text, :placeholder => "Your feedback", class: "comment_field" %>
                <%= f.hidden_field :post_id, :post_id => @post.id %>
                <%= f.submit "", class: "submit_comment" %>
              <% end %>
            </ul>
          </div>
          <% if current_user.admin? || current_user.id == @post.user_id %>
            <div class="btn_cntnr">
              <%= link_to "Turn off sharing", post_path(@post, sharing: false), :data => {:confirm => "Are you sure you want to turn off peer sharing?"}, class: "newpost--new--profile" %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
</br>
